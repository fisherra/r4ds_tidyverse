---
title: "Unpacking the Tidyverse - forcats"
author: "Fisher Ankney"
date: "September 2nd, 2018"
output: html_document
---

<br> 

load Library
```{r, message=F}
library('tidyverse')
```

<br> 

Load Data
```{r, eval=F, echo=T}
# load data as dataframe from the url in its .csv form, insure no column names
income_predict_data <- as_data_frame(read_csv(url("https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data"), col_names = F))

# name columns
colnames(income_predict_data) <- c("age", "workclass", "fnlwgt", "education", "education_num", "marital_status", "occupation", "relationship", "race", "sex", "capital_gains", "capital_loss", "hours_per_week", "native_country", "income_prediction")

# save data incase source disappears
write_csv(income_predict_data, "r4ds_tidyverse/tidyverse_packages/forcats_data.csv")
```

<br>


```{r, echo=F}
income_predict_data <- read_csv("forcats_data.csv")
```

<br>
```{r}
# view data
income_predict_data
```

Data found [here](https://archive.ics.uci.edu/ml/datasets/Adult)

Variables Described - 
```
age: continuous.

workclass: Private, Self-emp-not-inc, Self-emp-inc, Federal-gov, Local-gov, State-gov, Without-pay, Never-worked.

fnlwgt: continuous.

education: Bachelors, Some-college, 11th, HS-grad, Prof-school, Assoc-acdm, Assoc-voc, 9th, 7th-8th, 12th, Masters, 1st-4th, 10th, Doctorate, 5th-6th, Preschool.

education_num: continuous.

marital-status: Married-civ-spouse, Divorced, Never-married, Separated, Widowed, Married-spouse-absent, Married-AF-spouse.

occupation: Tech-support, Craft-repair, Other-service, Sales, Exec-managerial, Prof-specialty, Handlers-cleaners, Machine-op-inspct, Adm-clerical, Farming-fishing, Transport-moving, Priv-house-serv, Protective-serv, Armed-Forces.

relationship: Wife, Own-child, Husband, Not-in-family, Other-relative, Unmarried.

race: White, Asian-Pac-Islander, Amer-Indian-Eskimo, Other, Black.

sex: Female, Male.

capital_gain: continuous.

capital_loss: continuous.

hours-per_week: continuous.

native_country: United-States, Cambodia, England, Puerto-Rico, Canada, Germany, Outlying-US(Guam-USVI-etc), India, Japan, Greece, South, China, Cuba, Iran, Honduras, Philippines, Italy, Poland, Jamaica, Vietnam, Mexico, Portugal, Ireland, France, Dominican-Republic, Laos, Ecuador, Taiwan, Haiti, Columbia, Hungary, Guatemala, Nicaragua, Scotland, Thailand, Yugoslavia, El-Salvador, Trinadad&Tobago, Peru, Hong, Holand-Netherlands.

income_prediction: <=50k, >50k
```

Now let's learn some forcats!


Can view categorical data by using the count function (dplyr)
```{r}
income_predict_data %>%
  count(race)
```

<br> 

Can view data by visualization (ggplot2)
```{r}
income_predict_data %>%
  ggplot(aes(education)) + 
  geom_bar()

```


Education data is sorted alpha numerically, that doesn't make sense. give this factor some levels! 

add levels to the education data because it's ordered categorical data (base R)
```{r}
# view possible categories
unique(income_predict_data$education)

# order categories
education_levels <- c("Preschool", "1st-4th", "5th-6th", "7th-8th", "9th", "10th", "11th", "12th", "HS-grad", "Some-college", "Assoc-acdm", "Assoc-voc", "Bachelors", "Masters", "Prof-school", "Doctorate")

income_predict_data$education <- factor(income_predict_data$education, levels=education_levels)

income_predict_data %>%
  ggplot(aes(education)) + 
  geom_bar()
```

<br> 

That makes more sense. 

how do we do that for a numeric factor?
```{r}
# view possible categories
unique(income_predict_data$hours_per_week)

# order categories
sorted_hours <- sort(unique(income_predict_data$hours_per_week))

sorted_hours 
```

```{r}
# create average hours worked variable (by education level)
education_hours_summary <- income_predict_data %>%
  group_by(education) %>%
  summarise(
    avg_hours_worked = mean(hours_per_week, na.rm = TRUE)
  )

# plot average hours worked vs education level 
ggplot(education_hours_summary) + 
  geom_point(aes(avg_hours_worked, education)) + 
  theme_minimal()

```

well lets try reordering them according to their average hours worked now using fct_reorder (forcats)
```{r}
education_hours_summary %>%
  mutate(education = fct_reorder(education, avg_hours_worked)) %>%
  ggplot(aes(avg_hours_worked, education)) + 
  geom_point()
```

easy peasy 

reorder the factor according to frequency fct_rev reverses order small to large
```{r}
income_predict_data %>%
  mutate(education = education %>% fct_infreq() %>% fct_rev()) %>%
  ggplot(aes(education)) + 
  geom_bar()
```

Dont like the name of the categories? factor recode

```{r}
income_predict_data %>%
  mutate(education = fct_recode(education, 
         "Associates" = "Assoc-acdm",
         "Vocational" = "Assoc-voc",
         "Professional" = "Prof-school"
         )) %>%
  count(education)
```





Don't like all those categories and want to lump some? a few choices

```{r}
# lump the smallest groups together to other, num big groups = 5
income_predict_data %>%
  mutate(education = fct_lump(education, n = 5)) %>%
  count(education)
```


```{r}
income_predict_data %>%
  mutate(education = fct_collapse(education,
        advanced_degree = c("Assoc-acdm","Bachelors", "Masters",
                            "Doctorate", "Prof-school")
  )) %>%
  ggplot(aes(education)) + 
  geom_bar()
```

  or use factor recode to put multiple categories into a new category 
```{r}
income_predict_data %>%
mutate(education = fct_recode(education,
      "drop_out" = "Preschool",
      "drop_out" = "1st-4th",
      "drop_out" = "5th-6th",
      "drop_out" = "7th-8th", 
      "drop_out" = "9th",
      "drop_out" = "10th", 
      "drop_out" = "11th",
      "drop_out" = "12th")
      ) %>%
ggplot(aes(education)) + 
geom_bar()
  
```

and that's the useful forcats!

till next time, 

fisher